<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="http://sarkarandassociates.localhost/th/sbap/css/styles.css?v=5eaea8354bf8c"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="http://sarkarandassociates.localhost/th/sbap/assets/img/favicon.png"
    />
    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js"></script> -->
    <link
      href="//stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <script src="//cdnjs.cloudflare.com/ajax/libs/feather-icons/4.24.1/feather.min.js"></script>
    <script src="//unpkg.com/autonumeric"></script>
    <script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="//stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="http://sarkarandassociates.localhost/th/sbap/js/scripts.js?v=5eaea83577598"></script>

    <script src="http://sarkarandassociates.localhost/th/common/common.lib.js?v=5eaea8357776a"></script>
    <script src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="//cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>

    <link
      href="//cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css"
      rel="stylesheet"
    />

    <link
      href="//res.cloudinary.com/cblpay/raw/upload/webres/plg/bsdp/css/bootstrap-datepicker.css"
      rel="stylesheet"
    />
    <script src="//res.cloudinary.com/cblpay/raw/upload/webres/plg/bsdp/js/bootstrap-datepicker.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  </head>
  <body>
    <div class="container-fluid formContainer">
      <div class="card">
        <div class="card-body">
          <div class="card-title">GST Details</div>
          <div class="col-12">
            <div class="row">
              <div class="form-group col-md-6">
                <label for="" class="">GSTIN</label>
                <input
                  type="text"
                  class="form-control cd-control"
                  placeholder="GSTIN"
                />
              </div>

              <div class="form-group col-md-6">
                <label for="" class="">State</label>
                <select class="form-control cd-control">
                  <option value="Ex">EXa</option>
                  <option value="Ex2">EX2a</option>
                </select>
              </div>

              <div class="form-group col-md-6">
                <label for="" class="">Types</label>
                <div class="border p-2 cd-control">
                  <span class="custom-control custom-checkbox"
                    ><input
                      type="checkbox"
                      class="custom-control-input"
                      name=""
                      id=""
                    /><label class="custom-control-label" for=""
                      >Opt 1</label
                    ></span
                  >
                  <span class="custom-control custom-checkbox"
                    ><input
                      type="checkbox"
                      class="custom-control-input"
                      name=""
                      id=""
                    /><label class="custom-control-label" for=""
                      >Opt 2</label
                    ></span
                  >
                  <span class="custom-control custom-checkbox"
                    ><input
                      type="checkbox"
                      class="custom-control-input"
                      name=""
                      id=""
                    /><label class="custom-control-label" for=""
                      >Opt 3</label
                    ></span
                  >
                  <span class="custom-control custom-checkbox"
                    ><input
                      type="checkbox"
                      class="custom-control-input"
                      name=""
                      id=""
                    /><label class="custom-control-label" for=""
                      >Opt 4</label
                    ></span
                  >
                  <span class="custom-control custom-checkbox"
                    ><input
                      type="checkbox"
                      class="custom-control-input"
                      name=""
                      id=""
                    /><label class="custom-control-label" for=""
                      >Opt 5</label
                    ></span
                  >
                  <span class="custom-control custom-checkbox"
                    ><input
                      type="checkbox"
                      class="custom-control-input"
                      name=""
                      id=""
                    /><label class="custom-control-label" for=""
                      >Opt 6</label
                    ></span
                  >
                </div>
              </div>

              <div class="form-group col-md-6">
                <label for="" class="">avcd</label>
                <textarea
                  class="form-control cd-control"
                  placeholder="acd"
                ></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      // var dtypes = JSON.parse(@json($DataTypeJson));
    </script>

    <script>
      var customData = {
        id: 1,
        sort_order: null,
        slug: "title-ol-p01",
        title: "Title ol p01",
        count: 6,
        is_optional: false,
        description: "hi",
        total_fields: 4,
        fields: [
          {
            field_type: "textbox",
            child_title: "Text Field 01",
            child_slug: "text-field-01",
            is_optional: false,
            default: "nope",
            sort_order: 0,
          },
          {
            field_type: "dropdown",
            child_title: "Single Value Option Field 001",
            child_slug: "single-value-option-field-001",
            is_optional: true,
            total_options: 3,
            options: [
              {
                value: "Text 01",
                key: "text-01",
                sort_order: 0,
                is_default: false,
              },
              {
                is_default: true,
                value: "Text 02",
                key: "text-02",
                sort_order: 1,
              },
              {
                value: "Text 03",
                key: "text-03",
                sort_order: 2,
                is_default: false,
              },
            ],
            sort_order: 1,
          },
          {
            field_type: "checkbox",
            child_title: "Multi Value Option Field 01",
            child_slug: "multi-value-option-field-01",
            is_optional: true,
            total_options: 3,
            options: [
              {
                is_default: true,
                value: "Option 001",
                key: "option-001",
                sort_order: 0,
              },
              {
                value: "Option 002",
                key: "option-002",
                sort_order: 1,
                is_default: false,
              },
              {
                is_default: true,
                value: "Option 003",
                key: "option-003",
                sort_order: 2,
              },
            ],
            sort_order: 2,
          },
          {
            field_type: "textarea",
            child_title: "Long Text Field 001",
            child_slug: "long-text-field-001",
            is_optional: true,
            default: "No Value",
            sort_order: 3,
          },
        ],
        is_active: true,
        is_editable: true,
        is_removable: true,
        created_at: "2020-04-22 19:45:13",
        updated_at: "2020-04-22 19:45:13",
      };

      var dtypes = customData.fields;
    </script>

    <script>
      // console.log(dtypes);
      window.cfg = {};
      var DataType = {
        textbox: "textbox",
        checkbox: "checkbox",
        dropdown: "dropdown",
        textarea: "textarea",
      };

      var config = {
        controlGroupClass: "from-group cd-from-group col-md-6",
        controlClass: "form-control cd-control-input",
        controlLabelClass: "cd-control-label",
        controlSpecialWrapperClass: "border p-2 cd-control",
      };

      $(document).ready(function () {
        var wrp = $(".formContainer");
        var wFrmD = $(`
                    <div class="card">
                        <div class="card-body">
                            <div class="card-title">[Data Title]</div>
                            <div class="col-12 cd-fields-container"></div>
                            <div class="col-12 cd-fields-control-container">
                                <button type="button" class="btn btn-link text-dark cd-btn-add-row">+ Add Another</button>
                            </div>
                        </div>
                    </div>
                `);
        var sectionWrapper = wFrmD.find(".cd-fields-container");
        // wFrmD.data("dataCount", 1);
        wFrmD.find(".card-title").text(customData.title);
        wFrmD.find(".card").attr("data-dlr", "false");
        var dataCount = customData.count > 0 ? customData.count : 1;
        for (let index = 0; index < dataCount; index++) {
          var rowWrapper = CDCreateSectionRow(customData, index);
          sectionWrapper.append(rowWrapper);
        }
        wFrmD
          .data({
            limit: customData.count,
            rawData: Object.assign({}, customData),
          })
          .attr({
            "data-limit": customData.count,
          });
        // sectionWrapper.appendTo(wrp);
        wrp.empty().html(wFrmD);
        CDRefreshData();

        // console.log(wrp);
      });

      //
      function CDCreateSectionRow(customData, index) {
        var rowWrapper = $(`
          <div class="row cd-each-data-row border mt-2">
            <div class="col-md-1 text-center mt-2">
                <code class="cd-slno-text h3 ">${index + 1}</code>
                <div class="p-2 m-1 text-center">
                  <button type="button" class="btn btn-icon btn-outline-dark-xx  text-danger cd-btn-remove-row" title="Remove"> <i class="fa fa-times fa-2x"></i> </button>
                </div>
            </div>
            <div class="col-md-11 border mt-2 p-2">
                <div class="row cd-fields p-2"></div>
            </div>
          </div>
        `);
        customData.fields.forEach(function (dType) {
          // alert(12798);
          var arg = Array.from(arguments);
          //   console.log(arg, dType);
          CDProcessControls.apply(rowWrapper.find(".cd-fields"), arg);
        });
        return rowWrapper;
      }

      //
      function CDRefreshData() {
        var wrp = $(".formContainer");
        var Sections = wrp.find(".card").each(function (ind, sect) {
          var customData = $(sect).data("rawData");

          var rows = $(sect).find(".cd-fields-container .cd-each-data-row")
            .length;
          var nextSl = rows + 1;
          $(sect).data("dataCount", rows);
          $(sect).data("dataNextSl", nextSl);
          $(sect).attr("data-data-count", rows);
          $(sect).attr("data-data-Next-Sl", nextSl);
          var reachedLimit = customData.count == rows;
          $(sect).data("dataReachedLimit", reachedLimit);
          $(sect).attr("data-data-reached-limit", reachedLimit);

          $(sect)
            .find(".cd-fields-container .cd-each-data-row")
            .each(function (rowIn, echRow) {
              $(echRow)
                .attr({
                  "data-row-total": rows,
                  "data-row-index": rowIn,
                })
                .data({
                  rowCount: rows,
                  rowIndex: rowIn,
                });
              $(echRow)
                .find(".cd-slno-text")
                .text(rowIn + 1);
            });

          $(sect)
            .find(".cd-control-input")
            .each(function (xxi, elemnt) {
              GenerateFieldNameFormIndex(elemnt, customData, ind);
            });
        });
      }
      //
      function CDProcessControls(tyP, indX) {
        var secWrap = $(this);
        // console.log([secWrap, tyP, indX]);

        var cg = CDControlGroupWrapper(tyP, indX);
        var lbl = cg.find("." + config.controlLabelClass);
        var inpId = tyP.child_slug + "-0";
        lbl.attr("for", inpId);
        var inp = $("<input />", {
          class: config.controlClass,
          placeholder: tyP.child_title,
          title: tyP.child_title,
        });
        // console.log(inp, cg, lbl, inpId);

        //textbox
        if (tyP.field_type == DataType.textbox) {
          inp = $("<input />", {
            type: "text",
            class: config.controlClass,
            placeholder: tyP.child_title,
            title: tyP.child_title,
            value: tyP.default,
            id: inpId,
          });
        }
        //textarea
        else if (tyP.field_type == DataType.textarea) {
          inp = $("<textarea />", {
            class: config.controlClass,
            placeholder: tyP.child_title,
            title: tyP.child_title,
            value: tyP.default,
            id: inpId,
          }).text(tyP.default);
        }
        //textarea
        else if (tyP.field_type == DataType.dropdown) {
          inp = $("<select />", {
            type: "text",
            class: config.controlClass,
            placeholder: tyP.child_title,
            title: tyP.child_title,
            value: tyP.default,
            id: inpId,
          });
          GetDropDownOptions(tyP, inp);
        }
        //checkbox
        else if (tyP.field_type == DataType.checkbox) {
          inp = $("<div />", {
            class: config.controlSpecialWrapperClass,
            // placeholder: tyP.child_title,
            title: tyP.child_title,
          });
          GetCheckboxOptions(tyP, inp);
          inp.find(":input").data("dataType", tyP);
        }
        // inp.appendTo(cg);
        inp.data("dataType", tyP);

        cg.append(inp);
        secWrap.append(cg);
      }
      //
      function CDControlGroupWrapper(tyP, indX) {
        var jx = `
            <div class="${config.controlGroupClass}">
                <label for="" class="${config.controlLabelClass}">${tyP.child_title}</label>
            </div>
            `;
        return $(jx);
      }
      //dropdown options
      function GetDropDownOptions(tyP, selectElem) {
        tyP.options.forEach(function (op, indx) {
          var optId = ["cb", tyP.child_slug, GetNewGUID()].join("-");
          var opt = $("<option />", {
            "data-index": indx,
            value: op.key,
            text: op.value,
            id: optId,
          }).text(op.value);
          if (op.is_default) {
            opt.attr("selected", "selected");
          }
          selectElem.append(opt);
        });
      }

      //Checkbox options
      function GetCheckboxOptions(tyP, selectElem) {
        tyP.options.forEach(function (op, indx) {
          var strOpt = `
            <span class="custom-control custom-checkbox" >
                <input type="checkbox" class="custom-control-input cd-control-input" name="" id=""/>
                <label class="custom-control-label" for="" >Opt 4</label>
            </span>
            `;
          var optId = ["cb", tyP.child_slug, GetNewGUID()].join("-");
          var OptSpan = $(strOpt);
          var opt = OptSpan.find(":checkbox").attr("id", optId);
          var label = OptSpan.find("label").attr("for", optId);
          if (op.is_default) {
            opt.prop("checked", true);
          }
          selectElem.append(OptSpan);
        });
      }
      //abcd
      function CDCfg(key, value) {
        var cfg = window.cfg;
        if (key) {
          if (arguments.length > 1) {
            window.cfg[key] = value;
          } else return cfg[key];
        } else return window.cfg;
      }
           
      function GenerateFieldNameFormIndex(element, CData, rowIndex) {
        element = $(element);
        var dType = $(element).data("dataType");
        var namePrefix = `CustomData[${CData.slug}][${rowIndex}][${dType.child_slug}]`;
        if (dType.field_type != DataType.checkbox) {
          element.attr("name", namePrefix);
        } else {
          element.attr("name", namePrefix + "[]");
        }
      }
    </script>

    <script>
      $(document).ready(function () {
        //eachRowDeleteBtn
        $(document).on("click", ".cd-btn-remove-row", function () {
          var thisRow = $(this).parents(".cd-each-data-row").first();
          var cardSd = $(this).parents(".card").first();
          var count = cardSd.find(".cd-each-data-row").length;
          if (count > 1) {
            $(this).parents(".cd-each-data-row").remove();
          }
          CDRefreshData();
        });
        //addRowBtn
        $(document).on("click", ".cd-btn-add-row", function () {
          var thisRow = $(this).parents(".cd-each-data-row").first();
          var cardSd = $(this).parents(".card").first();
          var customData = cardSd.data("rawData");
          var rows = cardSd.find(".cd-each-data-row").length;
          var reachedLimit = customData.count == rows;
          if (!reachedLimit) {
            var wrapper = CDCreateSectionRow(customData, rows);
            cardSd.find(".cd-fields-container").append(wrapper);
          }
          CDRefreshData();
        });
      });
    </script>
    <style>
      [data-row-total="1"][data-row-index="0"] .cd-slno-text,
      [data-row-total="1"][data-row-index="0"] .cd-btn-remove-row {
        display: none;
      }
    </style>
  </body>
</html>
